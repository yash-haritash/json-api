name: Fetch JSON and Create PR
on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:  # Allows manual trigger

jobs:
  fetch-and-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch JSON Data
        id: fetch-json
        uses: engahmeds3ed/create-json-url@v0.0.1
        with:
          name: 'data.json'
          url: 'https://s3.ap-south-1.amazonaws.com/qa.unifyapps.com.cloudstorage.1/1/workflow_uploads/local_file/4e5898fd-125b-4d32-b9f9-0b1811847450f017e0b3-63dd-480f-8002-dceca617bcd5?response-content-disposition=attachment%3Bfilename%3D%224e5898fd-125b-4d32-b9f9-0b1811847450f017e0b3-63dd-480f-8002-dceca617bcd5%22&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEM7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCmFwLXNvdXRoLTEiRzBFAiEA6WCMrdvjx6aKQE%2FgQMECCfD7iA09R5yhJqfT7lJo%2FCkCIFFCxWS90l4Oe68dAxBcs%2F%2FwJa9U7Qc%2FPBQyTu7xdemkKsgFCKf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNTQ2OTE4MTA2MjgzIgw7gIOaASy9ZjsqM2kqnAWAJHevZsrgs6nA4eFcfAKphGTREly%2B0%2Fm4QQ12chtqQhTkkWO4Q2BehnQshSG3p1b3320FRLjIF5QLHevskIBTFKSfywM3EZalAUaW%2By69U1uzV2U9YMkjMrQrn9aaCXLvcOTUz6inyxEU6FjpozHar4S0j4inIu05QQs72MrnZ0utlZZPxSoMmUn46h6iiisRrCijnVKGK50ZRvyzPEDhD31ShO9xouhUUHB0TLsT2euF6pF%2F3O56dET4txVMp0fDeZDpqrC04i6iGoWc7IhC254B99m%2FCF%2FLnay5Ja5B6PFmmJ7s0ZxcPYJy6peEUENGJZkpTczOMlz07L%2FGOVYi%2BB1ghDhprXlck55jpceo4IlhT%2Ft1g3E4ilX3SYgz3TamoonfqcCmsIMfDttYUchevO0aL8oEfX6QWg%2FMlSRRP4FA86rJ%2BrSkyvRm9ZLL0J6XMvv3y4AboEGsCoIUJI9fA%2FAg%2BJj7%2B9WJTj2j2Kg%2FMyj%2Bfve%2BqvAeNJKgWMe4mX24AU8V8RvFSp1ugAr7Aam4AzJNTq3GnbaDR%2ByY49GcAfLjONs9WPKroPq2Pt1f%2BHoUuccPLICt%2BFoJdu2QyyBYf%2FmKfjWIjgfjQhUbj6R7PHnRSe1Mw7Da9NaGGoRBMPeY59dpN9J0LgGH1GvaPokHePljxuM5eCZsSMylc00S%2BpXzcm9NMT%2FyO3EiXsuQB9NlJYhhLwv%2Fl%2F8MjpXr1k9AhefGCgJ90W%2F90aYl0jGfjYws4F8sBJW9licISnG7h1Xl1ddlx5F8VH6pexZPN02JBuU9pnkh8w2cvU2%2BcgUqgpgmu5jIbDs3ImIFZRqoJEX%2FgUV%2Far7hU0CqffvX%2Bslgfmr0PgymATPOCSjDOl20BApJljBronbrhblVbjDIy5vCBjqxAUNkqf3LGbvd6kszKr%2BRPS3CntJoV7xSx9DWLFC3AQ%2FBHmHxUAeW7TiJV7p6VTY1lXHKeWckJfzeOrSURLWcfRkfZeaqVkm%2F4Ydfb%2BTU0xjNy%2BKNxQuHrfhedxCJc79bMqDN3QWhbZTzjKOtSVTVUP6H68sYS4xyyx7OL8YXzY%2FdSAXKIPK57tTKK9Htn%2FuNaAZ1FR5RN8dqffhaiMyfscbCH7OIvxR3LQbnCV5%2FSCNYTg%3D%3D&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20250609T144328Z&X-Amz-SignedHeaders=host&X-Amz-Credential=ASIAX6VW4ASVW3QIW3CX%2F20250609%2Fap-south-1%2Fs3%2Faws4_request&X-Amz-Expires=3600&X-Amz-Signature=ce843afbb24c8e9a07e163a3b6f601d3c8d17e96f533ded3257498574e131429'
          dir: 'data'

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'Update JSON data from GitHub Gist'
          title: 'Automated JSON Data Update'
          body: 'This PR updates the JSON data fetched from GitHub Gist.'
          branch: 'auto-update/json-data'
          base: 'main'
          delete-branch: true
